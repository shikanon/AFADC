<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>剧本基础信息 - AI漫剧快造</title>
    <script src="https://unpkg.byted-static.com/coze/space_ppt_lib/1.0.3-alpha.12/lib/tailwindcss.js"></script>
    <script src="https://unpkg.byted-static.com/fortawesome/fontawesome-free/6.7.2/js/all.min.js" data-auto-replace-svg="nest"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#6366f1',
                        secondary: '#8b5cf6',
                        tertiary: '#06b6d4',
                        success: '#10b981',
                        danger: '#ef4444',
                        warning: '#f59e0b',
                        info: '#3b82f6',
                        'text-primary': '#1f2937',
                        'text-secondary': '#6b7280',
                        'bg-light': '#f8fafc',
                        'border-light': '#e5e7eb'
                    },
                    boxShadow: {
                        'card': '0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06)',
                        'card-hover': '0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)'
                    }
                }
            }
        }
    </script>
    <style>
        .sidebar-transition {
            transition: width 0.3s ease-in-out;
        }
        
        .nav-item-active {
            background-color: theme('colors.primary');
            color: white;
        }
        
        .nav-item-hover:hover {
            background-color: theme('colors.bg-light');
            color: theme('colors.primary');
        }
        
        .search-focus:focus {
            outline: none;
            border-color: theme('colors.primary');
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }
        
        .form-input-focus:focus {
            outline: none;
            border-color: theme('colors.primary');
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }
        
        .upload-area {
            border: 2px dashed theme('colors.border-light');
            transition: all 0.3s ease;
        }
        
        .upload-area:hover {
            border-color: theme('colors.primary');
            background-color: rgba(99, 102, 241, 0.05);
        }
        
        .upload-area.dragover {
            border-color: theme('colors.primary');
            background-color: rgba(99, 102, 241, 0.1);
        }
    </style>
</head>
<body class="bg-bg-light min-h-screen">
    <!-- 顶部导航栏 -->
    <header id="top-navbar" class="fixed top-0 left-0 right-0 bg-white border-b border-border-light h-16 z-50">
        <div class="flex items-center justify-between h-full px-6">
            <!-- Logo和产品名称 -->
            <div id="logo-section" class="flex items-center space-x-3">
                <div class="w-8 h-8 bg-gradient-to-br from-primary to-secondary rounded-lg flex items-center justify-center">
                    <i class="fas fa-magic text-white text-sm"></i>
                </div>
                <h1 class="text-xl font-bold text-text-primary">AI漫剧快造</h1>
            </div>
            
            <!-- 全局搜索 -->
            <div id="global-search" class="flex-1 max-w-md mx-8">
                <div class="relative">
                    <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-text-secondary text-sm"></i>
                    <input type="text" id="global-search-input" placeholder="搜索项目、工作空间..." 
                           class="w-full pl-10 pr-4 py-2 border border-border-light rounded-lg search-focus">
                </div>
            </div>
            
            <!-- 右侧操作区 -->
            <div id="header-actions" class="flex items-center space-x-4">
                <!-- 消息通知 -->
                <button id="notification-btn" class="relative p-2 text-text-secondary hover:text-primary">
                    <i class="fas fa-bell text-lg"></i>
                    <span class="absolute -top-1 -right-1 w-3 h-3 bg-danger rounded-full"></span>
                </button>
                
                <!-- 用户头像 -->
                <div id="user-menu" class="relative">
                    <button id="user-avatar-btn" class="flex items-center space-x-2 p-1 rounded-lg hover:bg-bg-light">
                        <img src="https://s.coze.cn/image/Z3EOR1xVjR0/" 
                             alt="用户头像" class="w-8 h-8 rounded-full" data-category="人物">
                        <span class="text-sm text-text-primary">张小明</span>
                        <i class="fas fa-chevron-down text-xs text-text-secondary"></i>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- 左侧菜单 -->
    <aside id="sidebar" class="fixed left-0 top-16 bottom-0 w-60 bg-white border-r border-border-light sidebar-transition z-40">
        <nav id="sidebar-nav" class="p-4 space-y-2">
            <!-- 工作空间 -->
            <div id="workspace-section" class="mb-6">
                <h3 class="text-xs font-semibold text-text-secondary uppercase tracking-wider mb-3">工作空间</h3>
                <div class="space-y-1">
                    <a href="P-WORKSPACE_LIST.html" id="nav-workspace-list" 
                       class="flex items-center space-x-3 px-3 py-2 rounded-lg text-sm nav-item-hover">
                        <i class="fas fa-layer-group w-4"></i>
                        <span>工作空间管理</span>
                    </a>
                </div>
            </div>
            
            <!-- 项目管理 -->
            <div id="project-section" class="mb-6">
                <h3 class="text-xs font-semibold text-text-secondary uppercase tracking-wider mb-3">项目管理</h3>
                <div class="space-y-1">
                    <a href="P-PROJECT_LIST.html" id="nav-project-list" 
                       class="flex items-center space-x-3 px-3 py-2 rounded-lg text-sm nav-item-hover">
                        <i class="fas fa-folder w-4"></i>
                        <span>项目列表</span>
                    </a>
                </div>
            </div>
            
            <!-- 制作流程 -->
            <div id="workflow-section" class="mb-6">
                <h3 class="text-xs font-semibold text-text-secondary uppercase tracking-wider mb-3">制作流程</h3>
                <div class="space-y-1">
                    <a href="P-SCRIPT_INFO.html" id="nav-script-info" 
                       class="flex items-center space-x-3 px-3 py-2 rounded-lg text-sm nav-item-active">
                        <i class="fas fa-file-alt w-4"></i>
                        <span>剧本信息</span>
                    </a>
                    <a href="P-CHARACTER_GENERATION.html" id="nav-character" 
                       class="flex items-center space-x-3 px-3 py-2 rounded-lg text-sm nav-item-hover">
                        <i class="fas fa-user-friends w-4"></i>
                        <span>角色IP形象</span>
                    </a>
                    <a href="P-VOICE_SELECTION.html" id="nav-voice" 
                       class="flex items-center space-x-3 px-3 py-2 rounded-lg text-sm nav-item-hover">
                        <i class="fas fa-microphone w-4"></i>
                        <span>音色选择</span>
                    </a>
                    <a href="P-SCENARIO_EDITOR.html" id="nav-scenario" 
                       class="flex items-center space-x-3 px-3 py-2 rounded-lg text-sm nav-item-hover">
                        <i class="fas fa-film w-4"></i>
                        <span>分镜脚本</span>
                    </a>
                    <a href="P-IMAGE_GENERATION.html" id="nav-image" 
                       class="flex items-center space-x-3 px-3 py-2 rounded-lg text-sm nav-item-hover">
                        <i class="fas fa-image w-4"></i>
                        <span>分镜画面</span>
                    </a>
                    <a href="P-VIDEO_GENERATION.html" id="nav-video" 
                       class="flex items-center space-x-3 px-3 py-2 rounded-lg text-sm nav-item-hover">
                        <i class="fas fa-video w-4"></i>
                        <span>分镜视频</span>
                    </a>
                    <a href="P-VIDEO_EXPORT.html" id="nav-export" 
                       class="flex items-center space-x-3 px-3 py-2 rounded-lg text-sm nav-item-hover">
                        <i class="fas fa-download w-4"></i>
                        <span>视频导出</span>
                    </a>
                </div>
            </div>
            
            <!-- 素材库 -->
            <div id="material-section">
                <h3 class="text-xs font-semibold text-text-secondary uppercase tracking-wider mb-3">素材库</h3>
                <div class="space-y-1">
                    <a href="P-MATERIAL_LIBRARY.html" id="nav-material" 
                       class="flex items-center space-x-3 px-3 py-2 rounded-lg text-sm nav-item-hover">
                        <i class="fas fa-palette w-4"></i>
                        <span>素材库管理</span>
                    </a>
                </div>
            </div>
        </nav>
    </aside>

    <!-- 主内容区 -->
    <main id="main-content" class="ml-60 mt-16 p-6 min-h-screen">
        <!-- 页面头部 -->
        <div id="page-header" class="mb-6">
            <!-- 面包屑导航 -->
            <nav id="breadcrumb" class="mb-4">
                <ol class="flex items-center space-x-2 text-sm text-text-secondary">
                    <li><a href="P-PROJECT_LIST.html" class="hover:text-primary">项目管理</a></li>
                    <li><i class="fas fa-chevron-right text-xs"></i></li>
                    <li><span id="project-name-breadcrumb" class="text-text-primary">樱花之恋</span></li>
                    <li><i class="fas fa-chevron-right text-xs"></i></li>
                    <li><span class="text-text-primary">剧本基础信息</span></li>
                </ol>
            </nav>
            
            <!-- 页面标题和操作 -->
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-2xl font-bold text-text-primary mb-2">剧本基础信息</h1>
                    <p class="text-text-secondary">设置您的漫剧基本信息和风格</p>
                </div>
                <div class="flex items-center space-x-3">
                    <button id="save-btn" class="px-4 py-2 border border-border-light rounded-lg text-text-secondary hover:border-primary hover:text-primary">
                        <i class="fas fa-save mr-2"></i>保存
                    </button>
                    <button id="next-btn" class="bg-primary text-white px-6 py-2 rounded-lg hover:bg-primary/90 transition-colors">
                        <i class="fas fa-arrow-right mr-2"></i>下一步
                    </button>
                </div>
            </div>
        </div>

        <!-- 表单区域 -->
        <div id="form-container" class="bg-white rounded-xl shadow-card p-6 mb-6">
            <form id="script-info-form" class="space-y-6">
                <!-- 漫剧名称 -->
                <div id="drama-name-section" class="space-y-2">
                    <label for="drama-name" class="block text-sm font-medium text-text-primary">漫剧名称 *</label>
                    <input type="text" id="drama-name" name="drama-name" 
                           class="w-full px-4 py-3 border border-border-light rounded-lg form-input-focus" 
                           placeholder="请输入漫剧名称" value="樱花之恋" required>
                </div>

                <!-- 画风选择 -->
                <div id="style-selection-section" class="space-y-4">
                    <label class="block text-sm font-medium text-text-primary">画风选择 *</label>
                    
                    <!-- 选择方式 -->
                    <div class="space-y-3">
                        <label class="flex items-center space-x-3 cursor-pointer">
                            <input type="radio" name="style-type" value="text" class="text-primary" checked>
                            <span class="text-sm">文本描述</span>
                        </label>
                        <label class="flex items-center space-x-3 cursor-pointer">
                            <input type="radio" name="style-type" value="image" class="text-primary">
                            <span class="text-sm">参考图上传</span>
                        </label>
                    </div>

                    <!-- 文本描述输入框 -->
                    <div id="style-text-section" class="space-y-2">
                        <label for="style-text" class="block text-sm font-medium text-text-primary">画风描述 *</label>
                        <textarea id="style-text" name="style-text" rows="4"
                                  class="w-full px-4 py-3 border border-border-light rounded-lg form-input-focus resize-none" 
                                  placeholder="请详细描述您想要的画风，例如：日系二次元、清新唯美、手绘风格等..."
                                  required>日系二次元风格，清新唯美，樱花飞舞的校园场景，温暖的色调，细腻的线条</textarea>
                    </div>

                    <!-- 参考图上传区域 -->
                    <div id="style-image-section" class="space-y-2 hidden">
                        <label class="block text-sm font-medium text-text-primary">上传参考图 *</label>
                        <div id="upload-area" class="upload-area rounded-lg p-8 text-center cursor-pointer">
                            <input type="file" id="style-image-input" name="style-image" accept="image/*" class="hidden">
                            <div id="upload-placeholder" class="space-y-3">
                                <div class="w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center mx-auto">
                                    <i class="fas fa-cloud-upload-alt text-primary text-2xl"></i>
                                </div>
                                <div>
                                    <p class="text-sm font-medium text-text-primary">点击上传或拖拽图片到此处</p>
                                    <p class="text-xs text-text-secondary mt-1">支持 JPG、PNG 格式，文件大小不超过 10MB</p>
                                </div>
                            </div>
                            <div id="upload-preview" class="hidden">
                                <img id="preview-image" src="" alt="参考图预览" class="max-w-full h-48 mx-auto rounded-lg">
                                <button type="button" id="remove-image-btn" class="mt-3 text-sm text-danger hover:text-danger/80">
                                    <i class="fas fa-trash mr-1"></i>移除图片
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 视频比例和分辨率 -->
                <div id="video-settings-section" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- 视频比例 -->
                    <div class="space-y-2">
                        <label for="aspect-ratio" class="block text-sm font-medium text-text-primary">视频比例 *</label>
                        <select id="aspect-ratio" name="aspect-ratio" 
                                class="w-full px-4 py-3 border border-border-light rounded-lg form-input-focus" required>
                            <option value="16:9" selected>16:9 (宽屏)</option>
                            <option value="9:16">9:16 (竖屏)</option>
                            <option value="4:3">4:3 (标准)</option>
                            <option value="1:1">1:1 (正方形)</option>
                        </select>
                    </div>

                    <!-- 分辨率 -->
                    <div class="space-y-2">
                        <label for="resolution" class="block text-sm font-medium text-text-primary">分辨率 *</label>
                        <select id="resolution" name="resolution" 
                                class="w-full px-4 py-3 border border-border-light rounded-lg form-input-focus" required>
                            <option value="1080p" selected>1080P (1920x1080)</option>
                            <option value="720p">720P (1280x720)</option>
                            <option value="480p">480P (854x480)</option>
                            <option value="2160p">4K (3840x2160)</option>
                        </select>
                    </div>
                </div>

                <!-- 故事背景 -->
                <div id="story-background-section" class="space-y-2">
                    <label for="story-background" class="block text-sm font-medium text-text-primary">故事背景 *</label>
                    <textarea id="story-background" name="story-background" rows="6"
                              class="w-full px-4 py-3 border border-border-light rounded-lg form-input-focus resize-none" 
                              placeholder="请描述您的故事背景，包括时间、地点、主要人物关系等，这将帮助AI更好地理解和生成符合您期望的内容..."
                              required>故事发生在日本的一所普通高中，春天樱花盛开的季节。主角是一名高二学生，性格温柔内向，喜欢文学和音乐。她在樱花树下遇到了转校生，两人因为共同的兴趣爱好而逐渐走近，展开了一段青涩美好的校园恋情。故事充满了青春的悸动、友情的温暖和成长的烦恼。</textarea>
                </div>
            </form>
        </div>

        <!-- 底部操作区 -->
        <div id="bottom-actions" class="flex items-center justify-between bg-white rounded-xl shadow-card p-4">
            <button id="prev-btn" class="px-4 py-2 border border-border-light rounded-lg text-text-secondary hover:border-primary hover:text-primary">
                <i class="fas fa-arrow-left mr-2"></i>上一步
            </button>
            <div class="flex items-center space-x-3">
                <button id="save-bottom-btn" class="px-4 py-2 border border-border-light rounded-lg text-text-secondary hover:border-primary hover:text-primary">
                    <i class="fas fa-save mr-2"></i>保存
                </button>
                <button id="next-bottom-btn" class="bg-primary text-white px-6 py-2 rounded-lg hover:bg-primary/90 transition-colors">
                    <i class="fas fa-arrow-right mr-2"></i>下一步
                </button>
            </div>
        </div>
    </main>

    <!-- 保存成功提示 -->
    <div id="save-success-toast" class="fixed top-20 right-6 bg-success text-white px-6 py-3 rounded-lg shadow-lg transform translate-x-full transition-transform duration-300 z-50">
        <div class="flex items-center space-x-2">
            <i class="fas fa-check-circle"></i>
            <span>保存成功</span>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 解析URL参数的辅助函数
            function getUrlParams() {
                const params = {};
                const queryString = window.location.search.substring(1);
                const urlParams = new URLSearchParams(queryString);
                
                for(const [key, value] of urlParams.entries()) {
                    params[key] = value;
                }
                return params;
            }

            // 获取URL参数
            const params = getUrlParams();
            
            // 如果有project_id参数，可以根据项目ID加载对应的剧本信息
            if(params.projectId) {
                console.log('加载项目剧本信息，项目ID:', params.projectId);
                // 在实际应用中，这里会调用API获取项目数据
                // 目前使用模拟数据
            }

            // 画风选择切换
            const styleTypeRadios = document.querySelectorAll('input[name="style-type"]');
            const styleTextSection = document.querySelector('#style-text-section');
            const styleImageSection = document.querySelector('#style-image-section');
            const styleTextInput = document.querySelector('#style-text');
            const styleImageInput = document.querySelector('#style-image-input');

            styleTypeRadios.forEach(radio => {
                radio.addEventListener('change', function() {
                    if (this.value === 'text') {
                        styleTextSection.classList.remove('hidden');
                        styleImageSection.classList.add('hidden');
                        styleTextInput.required = true;
                        styleImageInput.required = false;
                    } else {
                        styleTextSection.classList.add('hidden');
                        styleImageSection.classList.remove('hidden');
                        styleTextInput.required = false;
                        styleImageInput.required = true;
                    }
                });
            });

            // 参考图上传功能
            const uploadArea = document.querySelector('#upload-area');
            const uploadPlaceholder = document.querySelector('#upload-placeholder');
            const uploadPreview = document.querySelector('#upload-preview');
            const previewImage = document.querySelector('#preview-image');
            const removeImageBtn = document.querySelector('#remove-image-btn');

            // 点击上传区域触发文件选择
            uploadArea.addEventListener('click', function() {
                if (!uploadPreview.classList.contains('hidden')) {
                    return;
                }
                styleImageInput.click();
            });

            // 文件选择后处理
            styleImageInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    handleFileUpload(file);
                }
            });

            // 拖拽上传
            uploadArea.addEventListener('dragover', function(e) {
                e.preventDefault();
                this.classList.add('dragover');
            });

            uploadArea.addEventListener('dragleave', function(e) {
                e.preventDefault();
                this.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', function(e) {
                e.preventDefault();
                this.classList.remove('dragover');
                const file = e.dataTransfer.files[0];
                if (file && file.type.startsWith('image/')) {
                    handleFileUpload(file);
                }
            });

            // 处理文件上传
            function handleFileUpload(file) {
                if (file.size > 10 * 1024 * 1024) {
                    alert('文件大小不能超过10MB');
                    return;
                }

                const reader = new FileReader();
                reader.onload = function(e) {
                    previewImage.src = e.target.result;
                    uploadPlaceholder.classList.add('hidden');
                    uploadPreview.classList.remove('hidden');
                };
                reader.readAsDataURL(file);
            }

            // 移除图片
            removeImageBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                styleImageInput.value = '';
                previewImage.src = '';
                uploadPlaceholder.classList.remove('hidden');
                uploadPreview.classList.add('hidden');
            });

            // 保存功能
            function saveForm() {
                const form = document.querySelector('#script-info-form');
                if (!form.checkValidity()) {
                    form.reportValidity();
                    return false;
                }

                // 收集表单数据
                const formData = {
                    dramaName: document.querySelector('#drama-name').value,
                    styleType: document.querySelector('input[name="style-type"]:checked').value,
                    styleText: document.querySelector('#style-text').value,
                    aspectRatio: document.querySelector('#aspect-ratio').value,
                    resolution: document.querySelector('#resolution').value,
                    storyBackground: document.querySelector('#story-background').value
                };

                // 如果是图片上传，添加图片数据
                if (formData.styleType === 'image' && styleImageInput.files.length > 0) {
                    formData.styleImage = styleImageInput.files[0];
                }

                console.log('保存剧本信息:', formData);
                
                // 显示保存成功提示
                showSaveSuccessToast();
                
                return true;
            }

            // 显示保存成功提示
            function showSaveSuccessToast() {
                const toast = document.querySelector('#save-success-toast');
                toast.classList.remove('translate-x-full');
                setTimeout(() => {
                    toast.classList.add('translate-x-full');
                }, 3000);
            }

            // 保存按钮事件
            document.querySelector('#save-btn').addEventListener('click', saveForm);
            document.querySelector('#save-bottom-btn').addEventListener('click', saveForm);

            // 下一步按钮事件
            function goToNextPage() {
                if (saveForm()) {
                    const projectId = params.projectId || 'project1';
                    window.location.href = `P-CHARACTER_GENERATION.html?projectId=${projectId}`;
                }
            }

            document.querySelector('#next-btn').addEventListener('click', goToNextPage);
            document.querySelector('#next-bottom-btn').addEventListener('click', goToNextPage);

            // 上一步按钮事件
            document.querySelector('#prev-btn').addEventListener('click', function() {
                window.location.href = 'P-PROJECT_LIST.html';
            });

            // 表单自动保存（每30秒）
            setInterval(function() {
                if (document.querySelector('#script-info-form').checkValidity()) {
                    console.log('自动保存剧本信息');
                    // 这里可以实现自动保存逻辑
                }
            }, 30000);

            // 导航菜单点击事件
            document.querySelector('#nav-workspace-list').addEventListener('click', function(e) {
                e.preventDefault();
                window.location.href = 'P-WORKSPACE_LIST.html';
            });

            document.querySelector('#nav-project-list').addEventListener('click', function(e) {
                e.preventDefault();
                window.location.href = 'P-PROJECT_LIST.html';
            });

            document.querySelector('#nav-character').addEventListener('click', function(e) {
                e.preventDefault();
                const projectId = params.projectId || 'project1';
                window.location.href = `P-CHARACTER_GENERATION.html?projectId=${projectId}`;
            });

            document.querySelector('#nav-voice').addEventListener('click', function(e) {
                e.preventDefault();
                const projectId = params.projectId || 'project1';
                window.location.href = `P-VOICE_SELECTION.html?projectId=${projectId}`;
            });

            document.querySelector('#nav-scenario').addEventListener('click', function(e) {
                e.preventDefault();
                const projectId = params.projectId || 'project1';
                window.location.href = `P-SCENARIO_EDITOR.html?projectId=${projectId}`;
            });

            document.querySelector('#nav-image').addEventListener('click', function(e) {
                e.preventDefault();
                const projectId = params.projectId || 'project1';
                window.location.href = `P-IMAGE_GENERATION.html?projectId=${projectId}`;
            });

            document.querySelector('#nav-video').addEventListener('click', function(e) {
                e.preventDefault();
                const projectId = params.projectId || 'project1';
                window.location.href = `P-VIDEO_GENERATION.html?projectId=${projectId}`;
            });

            document.querySelector('#nav-export').addEventListener('click', function(e) {
                e.preventDefault();
                const projectId = params.projectId || 'project1';
                window.location.href = `P-VIDEO_EXPORT.html?projectId=${projectId}`;
            });

            document.querySelector('#nav-material').addEventListener('click', function(e) {
                e.preventDefault();
                window.location.href = 'P-MATERIAL_LIBRARY.html';
            });
        });
    </script>
</body>
</html>