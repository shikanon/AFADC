<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>分镜视频生成与编辑 - AI漫剧快造</title>
    <script src="https://unpkg.byted-static.com/coze/space_ppt_lib/1.0.3-alpha.12/lib/tailwindcss.js"></script>
    <script src="https://unpkg.byted-static.com/fortawesome/fontawesome-free/6.7.2/js/all.min.js" data-auto-replace-svg="nest"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#6366f1',
                        secondary: '#8b5cf6',
                        tertiary: '#06b6d4',
                        success: '#10b981',
                        danger: '#ef4444',
                        warning: '#f59e0b',
                        info: '#3b82f6',
                        'text-primary': '#1f2937',
                        'text-secondary': '#6b7280',
                        'bg-light': '#f8fafc',
                        'border-light': '#e5e7eb'
                    },
                    boxShadow: {
                        'card': '0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06)',
                        'card-hover': '0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)'
                    }
                }
            }
        }
    </script>
    <style>
        .sidebar-transition {
            transition: width 0.3s ease-in-out;
        }
        
        .video-card-hover:hover {
            transform: translateY(-2px);
            transition: all 0.2s ease-in-out;
        }
        
        .nav-item-active {
            background-color: theme('colors.primary');
            color: white;
        }
        
        .nav-item-hover:hover {
            background-color: theme('colors.bg-light');
            color: theme('colors.primary');
        }
        
        .search-focus:focus {
            outline: none;
            border-color: theme('colors.primary');
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .video-progress {
            background: linear-gradient(90deg, theme('colors.primary') 0%, theme('colors.secondary') 100%);
            height: 4px;
            border-radius: 2px;
            transition: width 0.3s ease;
        }

        .editing-mode {
            border: 2px solid theme('colors.primary');
        }
    </style>
</head>
<body class="bg-bg-light min-h-screen">
    <!-- 顶部导航栏 -->
    <header id="top-navbar" class="fixed top-0 left-0 right-0 bg-white border-b border-border-light h-16 z-50">
        <div class="flex items-center justify-between h-full px-6">
            <!-- Logo和产品名称 -->
            <div id="logo-section" class="flex items-center space-x-3">
                <div class="w-8 h-8 bg-gradient-to-br from-primary to-secondary rounded-lg flex items-center justify-center">
                    <i class="fas fa-magic text-white text-sm"></i>
                </div>
                <h1 class="text-xl font-bold text-text-primary">AI漫剧快造</h1>
            </div>
            
            <!-- 全局搜索 -->
            <div id="global-search" class="flex-1 max-w-md mx-8">
                <div class="relative">
                    <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-text-secondary text-sm"></i>
                    <input type="text" id="global-search-input" placeholder="搜索项目、工作空间..." 
                           class="w-full pl-10 pr-4 py-2 border border-border-light rounded-lg search-focus">
                </div>
            </div>
            
            <!-- 右侧操作区 -->
            <div id="header-actions" class="flex items-center space-x-4">
                <!-- 消息通知 -->
                <button id="notification-btn" class="relative p-2 text-text-secondary hover:text-primary">
                    <i class="fas fa-bell text-lg"></i>
                    <span class="absolute -top-1 -right-1 w-3 h-3 bg-danger rounded-full"></span>
                </button>
                
                <!-- 用户头像 -->
                <div id="user-menu" class="relative">
                    <button id="user-avatar-btn" class="flex items-center space-x-2 p-1 rounded-lg hover:bg-bg-light">
                        <img src="https://s.coze.cn/image/eqTRly2g7iE/" 
                             alt="用户头像" class="w-8 h-8 rounded-full" data-category="人物">
                        <span class="text-sm text-text-primary">张小明</span>
                        <i class="fas fa-chevron-down text-xs text-text-secondary"></i>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- 左侧菜单 -->
    <aside id="sidebar" class="fixed left-0 top-16 bottom-0 w-60 bg-white border-r border-border-light sidebar-transition z-40">
        <nav id="sidebar-nav" class="p-4 space-y-2">
            <!-- 工作空间 -->
            <div id="workspace-section" class="mb-6">
                <h3 class="text-xs font-semibold text-text-secondary uppercase tracking-wider mb-3">工作空间</h3>
                <div class="space-y-1">
                    <a href="P-WORKSPACE_LIST.html" id="nav-workspace-list" 
                       class="flex items-center space-x-3 px-3 py-2 rounded-lg text-sm nav-item-hover">
                        <i class="fas fa-layer-group w-4"></i>
                        <span>工作空间管理</span>
                    </a>
                </div>
            </div>
            
            <!-- 项目管理 -->
            <div id="project-section" class="mb-6">
                <h3 class="text-xs font-semibold text-text-secondary uppercase tracking-wider mb-3">项目管理</h3>
                <div class="space-y-1">
                    <a href="P-PROJECT_LIST.html" id="nav-project-list" 
                       class="flex items-center space-x-3 px-3 py-2 rounded-lg text-sm nav-item-hover">
                        <i class="fas fa-folder w-4"></i>
                        <span>项目列表</span>
                    </a>
                </div>
            </div>
            
            <!-- 制作流程 -->
            <div id="workflow-section" class="mb-6">
                <h3 class="text-xs font-semibold text-text-secondary uppercase tracking-wider mb-3">制作流程</h3>
                <div class="space-y-1">
                    <a href="P-SCRIPT_INFO.html" id="nav-script-info" 
                       class="flex items-center space-x-3 px-3 py-2 rounded-lg text-sm nav-item-hover">
                        <i class="fas fa-file-alt w-4"></i>
                        <span>剧本信息</span>
                    </a>
                    <a href="P-CHARACTER_GENERATION.html" id="nav-character" 
                       class="flex items-center space-x-3 px-3 py-2 rounded-lg text-sm nav-item-hover">
                        <i class="fas fa-user-friends w-4"></i>
                        <span>角色IP形象</span>
                    </a>
                    <a href="P-VOICE_SELECTION.html" id="nav-voice" 
                       class="flex items-center space-x-3 px-3 py-2 rounded-lg text-sm nav-item-hover">
                        <i class="fas fa-microphone w-4"></i>
                        <span>音色选择</span>
                    </a>
                    <a href="P-SCENARIO_EDITOR.html" id="nav-scenario" 
                       class="flex items-center space-x-3 px-3 py-2 rounded-lg text-sm nav-item-hover">
                        <i class="fas fa-film w-4"></i>
                        <span>分镜脚本</span>
                    </a>
                    <a href="P-IMAGE_GENERATION.html" id="nav-image" 
                       class="flex items-center space-x-3 px-3 py-2 rounded-lg text-sm nav-item-hover">
                        <i class="fas fa-image w-4"></i>
                        <span>分镜画面</span>
                    </a>
                    <a href="P-VIDEO_GENERATION.html" id="nav-video" 
                       class="flex items-center space-x-3 px-3 py-2 rounded-lg text-sm nav-item-active">
                        <i class="fas fa-video w-4"></i>
                        <span>分镜视频</span>
                    </a>
                    <a href="P-VIDEO_EXPORT.html" id="nav-export" 
                       class="flex items-center space-x-3 px-3 py-2 rounded-lg text-sm nav-item-hover">
                        <i class="fas fa-download w-4"></i>
                        <span>视频导出</span>
                    </a>
                </div>
            </div>
            
            <!-- 素材库 -->
            <div id="material-section">
                <h3 class="text-xs font-semibold text-text-secondary uppercase tracking-wider mb-3">素材库</h3>
                <div class="space-y-1">
                    <a href="P-MATERIAL_LIBRARY.html" id="nav-material" 
                       class="flex items-center space-x-3 px-3 py-2 rounded-lg text-sm nav-item-hover">
                        <i class="fas fa-palette w-4"></i>
                        <span>素材库管理</span>
                    </a>
                </div>
            </div>
        </nav>
    </aside>

    <!-- 主内容区 -->
    <main id="main-content" class="ml-60 mt-16 p-6 min-h-screen">
        <!-- 页面头部 -->
        <div id="page-header" class="mb-6">
            <!-- 面包屑导航 -->
            <nav id="breadcrumb" class="mb-4">
                <ol class="flex items-center space-x-2 text-sm text-text-secondary">
                    <li><a href="P-PROJECT_LIST.html" class="hover:text-primary">项目管理</a></li>
                    <li><i class="fas fa-chevron-right text-xs"></i></li>
                    <li><span class="text-text-primary">樱花之恋</span></li>
                    <li><i class="fas fa-chevron-right text-xs"></i></li>
                    <li><span class="text-text-primary">分镜视频生成与编辑</span></li>
                </ol>
            </nav>
            
            <!-- 页面标题和操作 -->
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-2xl font-bold text-text-primary mb-2">分镜视频生成与编辑</h1>
                    <p class="text-text-secondary">生成和编辑分镜视频，调整视频效果</p>
                </div>
                <div class="flex items-center space-x-3">
                    <button id="batch-generate-btn" class="bg-primary text-white px-6 py-2 rounded-lg hover:bg-primary/90 transition-colors">
                        <i class="fas fa-play mr-2"></i>批量生成分镜视频
                    </button>
                    <button id="save-btn" class="bg-white border border-border-light text-text-primary px-6 py-2 rounded-lg hover:bg-bg-light transition-colors">
                        <i class="fas fa-save mr-2"></i>保存
                    </button>
                    <button id="next-btn" class="bg-secondary text-white px-6 py-2 rounded-lg hover:bg-secondary/90 transition-colors">
                        <i class="fas fa-arrow-right mr-2"></i>下一步
                    </button>
                </div>
            </div>
        </div>

        <!-- 生成状态显示 -->
        <div id="generation-status" class="bg-white rounded-xl shadow-card p-4 mb-6 hidden">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="w-8 h-8 bg-primary/10 rounded-full flex items-center justify-center">
                        <i class="fas fa-cog fa-spin text-primary"></i>
                    </div>
                    <div>
                        <h3 class="font-semibold text-text-primary">正在生成分镜视频</h3>
                        <p class="text-sm text-text-secondary">预计还需要 2 分钟</p>
                    </div>
                </div>
                <div class="flex items-center space-x-3">
                    <div class="w-32 h-2 bg-gray-200 rounded-full overflow-hidden">
                        <div id="generation-progress" class="video-progress w-3/4"></div>
                    </div>
                    <span class="text-sm text-text-secondary">75%</span>
                </div>
            </div>
        </div>

        <!-- 分镜视频列表 -->
        <div id="video-list" class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6 mb-8">
            <!-- 分镜视频1 -->
            <div id="video-card-1" class="bg-white rounded-xl shadow-card video-card-hover" data-scenario-id="scenario-1">
                <div class="relative">
                    <video id="video-player-1" class="w-full h-48 object-cover rounded-t-xl" controls poster="https://s.coze.cn/image/7lYE846io78/">
                        <source src="https://s.coze.cn/image/zXHEeb4pfXc/" type="video/mp4">
                        您的浏览器不支持视频播放。
                    </video>
                    <div class="absolute top-3 right-3">
                        <span class="bg-success/10 text-success px-2 py-1 rounded-full text-xs font-medium">已完成</span>
                    </div>
                    <div class="absolute bottom-3 left-3 right-3">
                        <button id="play-btn-1" class="w-full bg-black/50 text-white py-2 rounded-lg hover:bg-black/70 transition-colors">
                            <i class="fas fa-play mr-2"></i>播放视频
                        </button>
                    </div>
                </div>
                <div class="p-5">
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="font-semibold text-text-primary">分镜 001</h3>
                        <div class="flex items-center space-x-2">
                            <button id="edit-btn-1" class="text-primary hover:text-primary/80 text-sm">
                                <i class="fas fa-edit mr-1"></i>编辑
                            </button>
                            <button id="regenerate-btn-1" class="text-warning hover:text-warning/80 text-sm">
                                <i class="fas fa-redo mr-1"></i>重新生成
                            </button>
                        </div>
                    </div>
                    
                    <!-- 编辑模式 -->
                    <div id="edit-mode-1" class="hidden space-y-3 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-text-primary mb-1">主体</label>
                            <input type="text" id="subject-1" value="樱花树下的少女" 
                                   class="w-full px-3 py-2 border border-border-light rounded-lg search-focus text-sm">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-text-primary mb-1">动作</label>
                            <input type="text" id="action-1" value="缓慢行走，欣赏樱花" 
                                   class="w-full px-3 py-2 border border-border-light rounded-lg search-focus text-sm">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-text-primary mb-1">运镜</label>
                            <input type="text" id="camera-1" value="跟随镜头，缓慢推进" 
                                   class="w-full px-3 py-2 border border-border-light rounded-lg search-focus text-sm">
                        </div>
                        <div class="flex space-x-2">
                            <button id="apply-edit-1" class="flex-1 bg-primary text-white py-2 rounded-lg hover:bg-primary/90 text-sm">
                                <i class="fas fa-check mr-1"></i>应用
                            </button>
                            <button id="cancel-edit-1" class="flex-1 bg-gray-200 text-text-secondary py-2 rounded-lg hover:bg-gray-300 text-sm">
                                <i class="fas fa-times mr-1"></i>取消
                            </button>
                        </div>
                    </div>
                    
                    <!-- 预览模式 -->
                    <div id="preview-mode-1" class="space-y-2 mb-4">
                        <div class="flex items-center text-sm">
                            <span class="text-text-secondary w-16">主体：</span>
                            <span class="text-text-primary">樱花树下的少女</span>
                        </div>
                        <div class="flex items-center text-sm">
                            <span class="text-text-secondary w-16">动作：</span>
                            <span class="text-text-primary">缓慢行走，欣赏樱花</span>
                        </div>
                        <div class="flex items-center text-sm">
                            <span class="text-text-secondary w-16">运镜：</span>
                            <span class="text-text-primary">跟随镜头，缓慢推进</span>
                        </div>
                    </div>
                    
                    <div class="flex items-center justify-between text-xs text-text-secondary">
                        <span><i class="fas fa-clock mr-1"></i>00:03</span>
                        <span><i class="fas fa-file-video mr-1"></i>1080P</span>
                    </div>
                </div>
            </div>

            <!-- 分镜视频2 -->
            <div id="video-card-2" class="bg-white rounded-xl shadow-card video-card-hover" data-scenario-id="scenario-2">
                <div class="relative">
                    <video id="video-player-2" class="w-full h-48 object-cover rounded-t-xl" controls poster="https://s.coze.cn/image/EeIRyjqWFuM/">
                        <source src="https://s.coze.cn/image/rZAaWq4sdMc/" type="video/mp4">
                        您的浏览器不支持视频播放。
                    </video>
                    <div class="absolute top-3 right-3">
                        <span class="bg-success/10 text-success px-2 py-1 rounded-full text-xs font-medium">已完成</span>
                    </div>
                    <div class="absolute bottom-3 left-3 right-3">
                        <button id="play-btn-2" class="w-full bg-black/50 text-white py-2 rounded-lg hover:bg-black/70 transition-colors">
                            <i class="fas fa-play mr-2"></i>播放视频
                        </button>
                    </div>
                </div>
                <div class="p-5">
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="font-semibold text-text-primary">分镜 002</h3>
                        <div class="flex items-center space-x-2">
                            <button id="edit-btn-2" class="text-primary hover:text-primary/80 text-sm">
                                <i class="fas fa-edit mr-1"></i>编辑
                            </button>
                            <button id="regenerate-btn-2" class="text-warning hover:text-warning/80 text-sm">
                                <i class="fas fa-redo mr-1"></i>重新生成
                            </button>
                        </div>
                    </div>
                    
                    <!-- 编辑模式 -->
                    <div id="edit-mode-2" class="hidden space-y-3 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-text-primary mb-1">主体</label>
                            <input type="text" id="subject-2" value="少女与男主角相遇" 
                                   class="w-full px-3 py-2 border border-border-light rounded-lg search-focus text-sm">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-text-primary mb-1">动作</label>
                            <input type="text" id="action-2" value="两人对视，微笑" 
                                   class="w-full px-3 py-2 border border-border-light rounded-lg search-focus text-sm">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-text-primary mb-1">运镜</label>
                            <input type="text" id="camera-2" value="特写镜头，缓慢拉远" 
                                   class="w-full px-3 py-2 border border-border-light rounded-lg search-focus text-sm">
                        </div>
                        <div class="flex space-x-2">
                            <button id="apply-edit-2" class="flex-1 bg-primary text-white py-2 rounded-lg hover:bg-primary/90 text-sm">
                                <i class="fas fa-check mr-1"></i>应用
                            </button>
                            <button id="cancel-edit-2" class="flex-1 bg-gray-200 text-text-secondary py-2 rounded-lg hover:bg-gray-300 text-sm">
                                <i class="fas fa-times mr-1"></i>取消
                            </button>
                        </div>
                    </div>
                    
                    <!-- 预览模式 -->
                    <div id="preview-mode-2" class="space-y-2 mb-4">
                        <div class="flex items-center text-sm">
                            <span class="text-text-secondary w-16">主体：</span>
                            <span class="text-text-primary">少女与男主角相遇</span>
                        </div>
                        <div class="flex items-center text-sm">
                            <span class="text-text-secondary w-16">动作：</span>
                            <span class="text-text-primary">两人对视，微笑</span>
                        </div>
                        <div class="flex items-center text-sm">
                            <span class="text-text-secondary w-16">运镜：</span>
                            <span class="text-text-primary">特写镜头，缓慢拉远</span>
                        </div>
                    </div>
                    
                    <div class="flex items-center justify-between text-xs text-text-secondary">
                        <span><i class="fas fa-clock mr-1"></i>00:05</span>
                        <span><i class="fas fa-file-video mr-1"></i>1080P</span>
                    </div>
                </div>
            </div>

            <!-- 分镜视频3 -->
            <div id="video-card-3" class="bg-white rounded-xl shadow-card video-card-hover" data-scenario-id="scenario-3">
                <div class="relative">
                    <div class="w-full h-48 bg-gray-200 rounded-t-xl flex items-center justify-center">
                        <div class="text-center">
                            <i class="fas fa-video text-4xl text-text-secondary mb-2"></i>
                            <p class="text-sm text-text-secondary">等待生成</p>
                        </div>
                    </div>
                    <div class="absolute top-3 right-3">
                        <span class="bg-info/10 text-info px-2 py-1 rounded-full text-xs font-medium">待生成</span>
                    </div>
                </div>
                <div class="p-5">
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="font-semibold text-text-primary">分镜 003</h3>
                        <div class="flex items-center space-x-2">
                            <button id="edit-btn-3" class="text-primary hover:text-primary/80 text-sm">
                                <i class="fas fa-edit mr-1"></i>编辑
                            </button>
                            <button id="regenerate-btn-3" class="text-warning hover:text-warning/80 text-sm">
                                <i class="fas fa-play mr-1"></i>生成
                            </button>
                        </div>
                    </div>
                    
                    <!-- 编辑模式 -->
                    <div id="edit-mode-3" class="hidden space-y-3 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-text-primary mb-1">主体</label>
                            <input type="text" id="subject-3" value="两人在樱花树下交谈" 
                                   class="w-full px-3 py-2 border border-border-light rounded-lg search-focus text-sm">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-text-primary mb-1">动作</label>
                            <input type="text" id="action-3" value="轻松交谈，樱花飘落" 
                                   class="w-full px-3 py-2 border border-border-light rounded-lg search-focus text-sm">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-text-primary mb-1">运镜</label>
                            <input type="text" id="camera-3" value="全景镜头，轻微晃动" 
                                   class="w-full px-3 py-2 border border-border-light rounded-lg search-focus text-sm">
                        </div>
                        <div class="flex space-x-2">
                            <button id="apply-edit-3" class="flex-1 bg-primary text-white py-2 rounded-lg hover:bg-primary/90 text-sm">
                                <i class="fas fa-check mr-1"></i>应用
                            </button>
                            <button id="cancel-edit-3" class="flex-1 bg-gray-200 text-text-secondary py-2 rounded-lg hover:bg-gray-300 text-sm">
                                <i class="fas fa-times mr-1"></i>取消
                            </button>
                        </div>
                    </div>
                    
                    <!-- 预览模式 -->
                    <div id="preview-mode-3" class="space-y-2 mb-4">
                        <div class="flex items-center text-sm">
                            <span class="text-text-secondary w-16">主体：</span>
                            <span class="text-text-primary">两人在樱花树下交谈</span>
                        </div>
                        <div class="flex items-center text-sm">
                            <span class="text-text-secondary w-16">动作：</span>
                            <span class="text-text-primary">轻松交谈，樱花飘落</span>
                        </div>
                        <div class="flex items-center text-sm">
                            <span class="text-text-secondary w-16">运镜：</span>
                            <span class="text-text-primary">全景镜头，轻微晃动</span>
                        </div>
                    </div>
                    
                    <div class="flex items-center justify-between text-xs text-text-secondary">
                        <span><i class="fas fa-clock mr-1"></i>00:04</span>
                        <span><i class="fas fa-file-video mr-1"></i>1080P</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- 底部操作区 -->
        <div id="bottom-actions" class="bg-white rounded-xl shadow-card p-4">
            <div class="flex items-center justify-between">
                <button id="prev-btn" class="flex items-center space-x-2 px-4 py-2 border border-border-light rounded-lg text-text-secondary hover:border-primary hover:text-primary transition-colors">
                    <i class="fas fa-arrow-left"></i>
                    <span>上一步</span>
                </button>
                
                <div class="flex items-center space-x-3">
                    <button id="save-bottom-btn" class="px-6 py-2 bg-white border border-border-light text-text-primary rounded-lg hover:bg-bg-light transition-colors">
                        <i class="fas fa-save mr-2"></i>保存
                    </button>
                    <button id="next-bottom-btn" class="px-6 py-2 bg-secondary text-white rounded-lg hover:bg-secondary/90 transition-colors">
                        <span>下一步</span>
                        <i class="fas fa-arrow-right ml-2"></i>
                    </button>
                </div>
            </div>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 解析URL参数的辅助函数
            function getUrlParams() {
                const params = {};
                const queryString = window.location.search.substring(1);
                const urlParams = new URLSearchParams(queryString);
                
                for(const [key, value] of urlParams.entries()) {
                    params[key] = value;
                }
                return params;
            }

            // 获取URL参数
            const params = getUrlParams();
            const projectId = params.projectId || 'default-project';

            // 批量生成分镜视频
            document.querySelector('#batch-generate-btn').addEventListener('click', function() {
                const statusDiv = document.querySelector('#generation-status');
                statusDiv.classList.remove('hidden');
                
                // 模拟生成进度
                let progress = 0;
                const progressBar = document.querySelector('#generation-progress');
                const progressInterval = setInterval(() => {
                    progress += Math.random() * 15;
                    if (progress >= 100) {
                        progress = 100;
                        clearInterval(progressInterval);
                        setTimeout(() => {
                            statusDiv.classList.add('hidden');
                            alert('分镜视频批量生成完成！');
                        }, 500);
                    }
                    progressBar.style.width = progress + '%';
                    progressBar.nextElementSibling.textContent = Math.round(progress) + '%';
                }, 300);
            });

            // 保存按钮
            document.querySelector('#save-btn').addEventListener('click', function() {
                // 模拟保存操作
                this.innerHTML = '<i class="fas fa-check mr-2"></i>已保存';
                this.classList.add('bg-success');
                setTimeout(() => {
                    this.innerHTML = '<i class="fas fa-save mr-2"></i>保存';
                    this.classList.remove('bg-success');
                }, 2000);
            });

            document.querySelector('#save-bottom-btn').addEventListener('click', function() {
                document.querySelector('#save-btn').click();
            });

            // 下一步按钮
            document.querySelector('#next-btn').addEventListener('click', function() {
                window.location.href = `P-VIDEO_EXPORT.html?projectId=${projectId}`;
            });

            document.querySelector('#next-bottom-btn').addEventListener('click', function() {
                document.querySelector('#next-btn').click();
            });

            // 上一步按钮
            document.querySelector('#prev-btn').addEventListener('click', function() {
                window.location.href = `P-IMAGE_GENERATION.html?projectId=${projectId}`;
            });

            // 分镜视频编辑功能
            for (let i = 1; i <= 3; i++) {
                const editBtn = document.querySelector(`#edit-btn-${i}`);
                const editMode = document.querySelector(`#edit-mode-${i}`);
                const previewMode = document.querySelector(`#preview-mode-${i}`);
                const applyBtn = document.querySelector(`#apply-edit-${i}`);
                const cancelBtn = document.querySelector(`#cancel-edit-${i}`);

                editBtn.addEventListener('click', function() {
                    editMode.classList.remove('hidden');
                    previewMode.classList.add('hidden');
                    this.innerHTML = '<i class="fas fa-check mr-1"></i>完成';
                });

                applyBtn.addEventListener('click', function() {
                    const subject = document.querySelector(`#subject-${i}`).value;
                    const action = document.querySelector(`#action-${i}`).value;
                    const camera = document.querySelector(`#camera-${i}`).value;
                    
                    // 更新预览模式显示
                    const previewLines = previewMode.querySelectorAll('span:last-child');
                    previewLines[0].textContent = subject;
                    previewLines[1].textContent = action;
                    previewLines[2].textContent = camera;
                    
                    editMode.classList.add('hidden');
                    previewMode.classList.remove('hidden');
                    editBtn.innerHTML = '<i class="fas fa-edit mr-1"></i>编辑';
                    
                    alert('分镜视频设置已更新！');
                });

                cancelBtn.addEventListener('click', function() {
                    editMode.classList.add('hidden');
                    previewMode.classList.remove('hidden');
                    editBtn.innerHTML = '<i class="fas fa-edit mr-1"></i>编辑';
                });
            }

            // 重新生成按钮
            for (let i = 1; i <= 3; i++) {
                const regenerateBtn = document.querySelector(`#regenerate-btn-${i}`);
                regenerateBtn.addEventListener('click', function() {
                    if (confirm('确定要重新生成这个分镜视频吗？')) {
                        // 模拟重新生成
                        this.innerHTML = '<i class="fas fa-spinner fa-spin mr-1"></i>生成中...';
                        this.disabled = true;
                        
                        setTimeout(() => {
                            this.innerHTML = '<i class="fas fa-redo mr-1"></i>重新生成';
                            this.disabled = false;
                            alert('分镜视频重新生成完成！');
                        }, 3000);
                    }
                });
            }

            // 播放按钮
            for (let i = 1; i <= 2; i++) {
                const playBtn = document.querySelector(`#play-btn-${i}`);
                const videoPlayer = document.querySelector(`#video-player-${i}`);
                
                playBtn.addEventListener('click', function() {
                    if (videoPlayer.paused) {
                        videoPlayer.play();
                        this.innerHTML = '<i class="fas fa-pause mr-2"></i>暂停';
                    } else {
                        videoPlayer.pause();
                        this.innerHTML = '<i class="fas fa-play mr-2"></i>播放视频';
                    }
                });

                videoPlayer.addEventListener('ended', function() {
                    playBtn.innerHTML = '<i class="fas fa-play mr-2"></i>播放视频';
                });
            }

            // 全局搜索功能
            document.querySelector('#global-search-input').addEventListener('input', function(e) {
                console.log('全局搜索:', e.target.value);
            });

            // 通知按钮
            document.querySelector('#notification-btn').addEventListener('click', function() {
                console.log('打开通知中心');
            });

            // 用户菜单
            document.querySelector('#user-avatar-btn').addEventListener('click', function() {
                console.log('打开用户菜单');
            });
        });
    </script>
</body>
</html>